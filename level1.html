<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>ZIM - Code Creativity</title>

    <!-- zimjs.com - JavaScript Canvas Framework -->
    <script type="module">
      import zim from "https://zimjs.org/cdn/015/zim_game";
      //   import zim from "https://zimjs.com/cdn/015/zim_game";

      let assets = [
        "ice-cream.png",
        "chocolate-bar.png",
        "birthday-cake.png",
        "balloon.png",
        "peace.png",
        "background1.png",
        "roboto.ttf",
      ];
      let path = "assets/";

      // See Docs under Frame for FIT, FILL, FULL, and TAG
      new Frame(FIT, 1024, 768, light, dark, ready, assets, path);
      function ready() {
        // given F (Frame), S (Stage), W (width), H (height)
        // put code here
        let background = new Pic(assets[5]).center().sca(0.89).bot();
        let circle = new Pic(assets[4]).centerReg().sca(0.25).pos(10, 10);
        // .outline();

        const timer = new Timer({
          time: 20,
          color: black,
          font: "roboto",
          borderColor: dark,
          backgroundColor: white,
          borderWidth: 0.5,

          // isometric: LEFT, // isometric for left side of board
        }).loc(700, 50);

        timer.on("complete", () => {
          circle.noDrag();
          circle.removeAllEventListeners("pressup");
          new Pane({
            backgroundColor: white,
            content: {
              label: "Time's Up",
              message: "You were soooo close!",
              buttons: [
                {
                  backgroundColor: "green",
                  label: "Try again",
                  call: () => {
                    zgo("level1.html");
                  },
                },
              ],
            },
          }).center();
          zogr("loser");
        });

        circle.drag({ boundary: new Boundary(circle.x, 100, 0, 550) });

        const pointsCollection = [
          {
            points: [
              [-568.8, 632.6, 0, 0, -30, 0, 30, 0],
              [-459.8, 421.9, 0, 0, -30, 0, 9.1, 0],
              [-289.4, 400.6, 0, 0, -75.5, 53.9, 33.5, -23.9, "straight"],
              [-255.2, 272.7, 0, 0, -36.6, 44.8, 39.1, -48, "straight"],
              [-120.1, 430, 0, 0, -44.7, 34.8, 32.1, -25],
              [-107.8, 130.3, 0, 0, -30, 44, 28.8, -42.4],
              [8.4, 276.8, 0, 0, -34.9, 19.3, 76.7, -42.5],
              [50, 19.4, 0, 0, -42.4, 30.1, 42.4, -30.1],
              [150.3, 139.6, 0, 0, -30, 0, 30, 0],
              [300, 0, 0, 0, -30, 0, 30, 0],
            ],
            img: assets[0],
          },
          {
            points: [
              [-568.2, 480.3, 0, 0, -30, 0, 30, 0],
              [-459.8, 421.9, 0, 0, -74.1, -12.6, 74.1, 12.6],
              [-429.2, 154.7, 0, 0, -45.8, 80.7, 18, -31.7, "straight"],
              [-321.2, 278.5, 0, 0, -116.2, 29.3, 60, -15.1, "straight"],
              [-240.5, 381.5, 0, 0, -70, 55.1, 70, -55.1],
              [-191.3, 171, 0, 0, -37.5, 14.2, 37.5, -14.2],
              [-99.3, 293.3, 0, 0, -32.1, 73.5, 32.1, -73.5],
              [0.5, 278.4, 0, 0, -15.3, 46.6, 15.3, -46.6],
              [91, 230.8, 0, 0, -6.7, -65, 6.7, 65],
              [327.2, 218.3, 0, 0, -10.6, 95.1, 10.6, -95.1],
            ],
            img: assets[1],
          },
          {
            points: [
              [-568.2, 248.4, 0, 0, -30, 0, 30, 0],
              [-289.9, 194.9, 0, 0, -74.1, -12.6, 74.1, 12.6],
              [-240.9, 336.1, 0, 0, -91.8, 13.7, 43.2, -6.4, "straight"],
              [-148.4, 243.6, 0, 0, -87.1, 52.6, 53, -32, "straight"],
              [-132.7, 378.6, 0, 0, -70, 55.1, 70, -55.1],
              [-23.4, 279.7, 0, 0, -37.5, 14.2, 37.5, -14.2],
              [38.5, 362.1, 0, 0, -32.1, 73.5, 32.1, -73.5],
              [156.8, 328.9, 0, 0, 41, -70.8, -41, 70.8],
              [236.6, 419, 0, 0, -8.6, 55.3, 8.6, -55.3],
              [333, 436.6, 0, 0, -44.6, -174.6, 44.6, 174.6],
            ],
            img: assets[2],
          },
          {
            points: [
              [-568.8, 47.6, 0, 0, -30, 0, 30, 0],
              [-483.1, 129.9, 0, 0, -74.1, -12.6, 74.1, 12.6],
              [-409.8, 227.5, 0, 0, -91.8, 13.7, 43.2, -6.4, "straight"],
              [-351.3, 123.3, 0, 0, -87.1, 52.6, 53, -32, "straight"],
              [-304.5, 279.6, 0, 0, -70, 55.1, 70, -55.1],
              [-232, 361.2, 0, 0, -37.5, 14.2, 37.5, -14.2],
              [-122.6, 440.7, 0, 0, -32.1, 73.5, 32.1, -73.5],
              [58.8, 530.7, 0, 0, 41, -70.8, -41, 70.8],
              [227.9, 492.7, 0, 0, -8.6, 55.3, 8.6, -55.3],
              [346.6, 603.5, 0, 0, -44.6, -174.6, 44.6, 174.6],
            ],
            img: assets[3],
          },
        ];

        let winner = pointsCollection[rand(pointsCollection.length - 1)].img;

        // let target = new Circle({ color: winner }).pos(130, 30);

        let container = new Container(400, 100).pos(180, 10);
        let target = new Pic(winner)
          .addTo(container)
          .centerReg()
          .sca(0.25)
          .pos(250, 0);

        new Label("Find This: ", 30, "roboto", white, black, black)
          .addTo(container)
          .sca(1.5)
          .pos(50, 30);

        zog(winner);
        loop(pointsCollection.length, (i) => {
          let points = pointsCollection[i];

          const path = new Squiggle({
            color: black,
            thickness: 0.5,
            points: points.points,
            showControls: false,
            onTop: false,
          })
            .center()
            .drag();

          loop(path.pointCircles, (j) => {
            j.wiggle("x", j.x, 5, 15, 0.5, rand(1, 2));
            j.wiggle("y", j.y, 5, 15, 0.5, rand(1, 2));
          });

          Ticker.add(() => {
            path.update();
          });

          let object = new Pic(points.img)
            .centerReg()
            .sca(0.25)
            .loc(path.pointCircles[path.pointCircles.length - 1]);

          circle.on("pressup", () => {
            if (path.pointCircles[0].hitTestBounds(circle)) {
              zogr(path.pointCircles.length - 1);
              timer.stop();
              circle.animate({
                props: { path: path },
                time: 20,
                ease: "linear",
                drag: true,
                loop: true,
                loopCall: () => {
                  circle.pauseAnimate(true);
                  if (winner == points.img) {
                    new Pane({
                      content: {
                        titleBar: "Winner",
                        message: "Congratulations! You've won this level.",
                        buttons: [
                          {
                            backgroundColor: "green",
                            label: "Next Level",
                            call: () => {
                              zgo("level2.html");
                            },
                          },
                          {
                            backgroundColor: "green",
                            label: "Try again",
                            call: () => {
                              zgo("level1.html");
                            },
                          },
                        ],
                      },
                    }).center();
                    zogr("winner");
                  } else {
                    new Pane({
                      content: {
                        titleBar: "Try Again",
                        message: "You were soooo close!",
                        buttons: [
                          {
                            backgroundColor: "green",
                            label: "Try again",
                            call: () => {
                              zgo("level1.html");
                            },
                          },
                        ],
                      },
                    }).center();
                    zogr("loser");
                  }
                  // Ticker.add(ticker);
                  circle.percentComplete = 0.01;
                },
              });
              circle.pauseAnimate(false);
            }
          });
        });
      } // end ready
    </script>
    <meta name="viewport" content="width=device-width, user-scalable=no" />
  </head>
  <body></body>
</html>
