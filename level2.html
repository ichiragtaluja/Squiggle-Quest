<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>ZIM - Code Creativity</title>

    <!-- zimjs.com - JavaScript Canvas Framework -->
    <script type="module">
      import zim from "https://zimjs.org/cdn/015/zim_game";
      //   import zim from "https://zimjs.com/cdn/015/zim_game";

      let assets = [
        "airplane.png",
        "pizza.png",
        "panda.png",
        "rainbow.png",
        "peace.png",
        "background2.png",
        "roboto.ttf",
      ];
      let path = "assets/";

      // See Docs under Frame for FIT, FILL, FULL, and TAG
      new Frame(FIT, 1024, 768, light, dark, ready, assets, path);
      function ready() {
        // given F (Frame), S (Stage), W (width), H (height)
        // put code here
        let background = new Pic(assets[5]).center().sca(0.89).bot();
        let circle = new Pic(assets[4]).centerReg().sca(0.3).pos(10, 10);

        const timer = new Timer({
          time: 15,
          color: black,
          font: "roboto",
          borderColor: dark,
          backgroundColor: white,
          borderWidth: 0.5,
        }).loc(700, 50);

        timer.on("complete", () => {
          circle.removeAllEventListeners("pressup");
          circle.noDrag();
          new Pane({
            content: {
              titleBar: "Time's Up",
              message: "You were soooo close!",
              buttons: [
                {
                  backgroundColor: "green",
                  label: "Try again",
                  call: () => {
                    zgo("level2.html");
                  },
                },
              ],
            },
          }).center();
          zogr("loser");
        });

        circle.drag({ boundary: new Boundary(circle.x, 100, 0, 550) });

        const pointsCollection = [
          {
            points: [
              [-554.2, 677.3, 0, 0, -30, 0, 30, 0],
              [-449.1, 554.8, 0, 0, -46.9, -5.8, 46.9, 5.8],
              [-306, 454.5, 0, 0, 23.3, 111.6, -23.3, -111.6],
              [-194.1, 336.8, 0, 0, -39.8, -1, 39.8, 1],
              [-131.9, 245, 0, 0, -34.5, 67.4, 26.8, -52.3, "straight"],
              [-299.5, 270, 0, 0, -17.6, -45.2, 17.6, 45.2],
              [89.4, 309.3, 0, 0, -77.6, 29.6, 64.1, -24.5, "straight"],
              [154.4, 359.4, 0, 0, -48, 19.9, 48, -19.9],
              [151.6, 259.2, 0, 0, 35, 26.6, -35, -26.6],
              [87.8, 311.4, 0, 0, 38.2, -24.7, -37.2, 24, "straight"],
              [-23.2, 261.2, 0, 0, 3.7, -56, -2.1, 30.8],
              [-54.7, 377.6, 0, 0, -28.8, -50.6, 28.8, 50.6],
              [-12.8, 429.9, 0, 0, -25, -37, 19.4, 28.8],
              [-156.6, 458.9, 0, 0, 67.2, 31, -64, -29.5],
              [201.3, 403.7, 0, 0, -65.1, -7.7, 91.1, 10.8],
              [203.6, 150.2, 0, 0, -89.2, -5.8, 89.2, 5.8],
              [332, 75.7, 0, 0, -74.7, -0.9, 74.7, 0.9],
            ],
            img: assets[0],
          },
          {
            points: [
              [-547.4, 500.7, 0, 0, -30, 0, 30, 0],
              [-455.9, 458.8, 0, 0, -46.9, -5.8, 46.9, 5.8],
              [-361.3, 387.6, 0, 0, 23.3, 111.6, -23.3, -111.6],
              [-283.4, 314.4, 0, 0, -39.8, -1, 39.8, 1],
              [-37.7, 214.9, 0, 0, -34.5, 67.4, 26.8, -52.3, "straight"],
              [-163.6, 208, 0, 0, -17.6, -45.2, 17.6, 45.2],
              [-85.3, 425.7, 0, 0, -77.6, 29.6, 64.1, -24.5, "straight"],
              [47.6, 365.2, 0, 0, -48, 19.9, 48, -19.9],
              [54.6, 279.6, 0, 0, 35, 26.6, -35, -26.6],
              [-67.5, 272.6, 0, 0, 38.2, -24.7, -37.2, 24, "straight"],
              [-161, 399.9, 0, 0, 3.7, -56, -2.1, 30.8],
              [-61.5, 455.3, 0, 0, -43.3, 34.8, 43.3, -34.8],
              [198.8, 494, 0, 0, -25, -37, 19.4, 28.8],
              [87, 551, 0, 0, 67.2, 31, -64, -29.5],
              [80.9, 365.9, 0, 0, -65.1, -7.7, 91.1, 10.8],
              [246.3, 400.5, 0, 0, -89.2, -5.8, 89.2, 5.8],
              [351.5, 247.4, 0, 0, -74.7, -0.9, 74.7, 0.9],
            ],
            img: assets[1],
          },
          {
            points: [
              [-547.4, 334.8, 0, 0, -30, 0, 30, 0],
              [-412.2, 285.1, 0, 0, -46.9, -5.8, 46.9, 5.8],
              [-368.1, 211, 0, 0, 0, 0, 0, 0, "none"],
              [-302.8, 163.1, 0, 0, -39.8, -1, 39.8, 1],
              [-121.2, 213, 0, 0, -34.5, 67.4, 26.8, -52.3, "straight"],
              [-232.5, 239, 0, 0, -17.6, -45.2, 17.6, 45.2],
              [-229, 339.4, 0, 0, 21.3, -63.8, -21.3, 63.8],
              [-21.3, 371, 0, 0, -48, 19.9, 48, -19.9],
              [27.4, 282.5, 0, 0, 35, 26.6, -35, -26.6],
              [-67.5, 272.6, 0, 0, 38.2, -24.7, -37.2, 24, "straight"],
              [-198.9, 435.8, 0, 0, 3.7, -56, -2.1, 30.8],
              [-93.5, 463, 0, 0, -20, 22, 31.7, -34.8],
              [92, 434.8, 0, 0, -25, -37, 19.4, 28.8],
              [-12, 506.4, 0, 0, 67.2, 31, -64, -29.5],
              [105.2, 376.6, 0, 0, -65.1, -7.7, 91.1, 10.8],
              [189.1, 486.9, 0, 0, -89.2, -5.8, 89.2, 5.8],
              [342.7, 418.2, 0, 0, -74.7, -0.9, 74.7, 0.9],
            ],
            img: assets[2],
          },
          {
            points: [
              [-534.8, 47.6, 0, 0, -30, 0, 30, 0],
              [-483.1, 129.9, 0, 0, -74.1, -12.6, 74.1, 12.6],
              [-409.8, 227.5, 0, 0, -91.8, 13.7, 43.2, -6.4, "straight"],
              [-351.3, 123.3, 0, 0, -87.1, 52.6, 29.6, -17.9, "straight"],
              [-279.4, 258.6, 0, 0, -34.5, 67.4, 26.8, -52.3, "straight"],
              [-349, 258.4, 0, 0, 6.9, -58.9, -5.7, 49.1],
              [-230.9, 332.6, 0, 0, 9.7, -61.9, -9.7, 61.9],
              [-88.3, 366.1, 0, 0, -31.5, 5.3, 31.5, -5.3],
              [-149, 318.2, 0, 0, 14.8, -26.9, -36.6, 66.7, "straight"],
              [-122.6, 440.7, 0, 0, -56.4, 61.9, 31.7, -34.8],
              [45.4, 473.6, 0, 0, -25, -37, 19.4, 28.8],
              [-2.3, 529.7, 0, 0, 67.2, 31, -64, -29.5],
              [2.3, 443.5, 0, 0, -65.1, -7.7, 91.1, 10.8],
              [227.9, 492.7, 0, 0, -5, 32.3, 8.6, -55.3],
              [346.6, 603.5, 0, 0, -44.6, -174.6, 44.6, 174.6],
            ],
            img: assets[3],
          },
        ];

        let winner = pointsCollection[rand(pointsCollection.length - 1)].img;

        let container = new Container(400, 100).pos(180, 10);
        let target = new Pic(winner)
          .addTo(container)
          .centerReg()
          .sca(0.25)
          .pos(250, 0);

        new Label("Find This: ", 30, "roboto", white, black, black)
          .addTo(container)
          .sca(1.5)
          .pos(50, 30);

        zog(winner);
        loop(pointsCollection.length, (i) => {
          let points = pointsCollection[i];

          const path = new Squiggle({
            color: black,
            thickness: 0.5,
            points: points.points,
            showControls: false,
            onTop: false,
            interactive: false,
          })
            .center()
            .drag();

          loop(path.pointCircles, (j) => {
            j.wiggle("x", j.x, 5, 15, 0.5, rand(1, 2));
            j.wiggle("y", j.y, 5, 15, 0.5, rand(1, 2));
          });

          Ticker.add(() => {
            path.update();
          });

          let object = new Pic(points.img)
            .centerReg()
            .sca(0.25)
            .loc(path.pointCircles[path.pointCircles.length - 1]);

          circle.on("pressup", () => {
            if (path.pointCircles[0].hitTestBounds(circle)) {
              zogr(path.pointCircles.length - 1);
              timer.stop();
              circle.animate({
                props: { path: path },
                time: 20,
                ease: "linear",
                drag: true,
                loop: true,
                loopCall: () => {
                  circle.pauseAnimate(true);
                  if (winner == points.img) {
                    new Pane({
                      content: {
                        titleBar: "Winner",
                        message: "Congratulations! You've won this level.",
                        buttons: [
                          {
                            width: 300,
                            height: 100,
                            backgroundColor: "green",
                            label: "Next Level",
                            call: () => {
                              zgo("level3.html");
                            },
                          },
                          {
                            width: 300,
                            height: 100,
                            backgroundColor: "green",
                            label: "Try this again!",
                            call: () => {
                              zgo("level2.html");
                            },
                          },
                        ],
                      },
                    }).center();
                    zogr("winner");
                  } else {
                    new Pane({
                      content: {
                        titleBar: "Try Again",
                        message: "You were soooo close!",
                        buttons: [
                          {
                            width: 300,
                            height: 100,
                            backgroundColor: "green",
                            label: "Try again",
                            call: () => {
                              zgo("level2.html");
                            },
                          },
                        ],
                      },
                    }).center();
                    zogr("loser");
                  }
                  // Ticker.add(ticker);
                  circle.percentComplete = 0.01;
                },
                //   startPercent: 50,
                //   percent: 50,
                //   rewind: true,
                //   startPaused: false,
              });
              circle.pauseAnimate(false);
            }
          });
        });
      } // end ready
    </script>
    <meta name="viewport" content="width=device-width, user-scalable=no" />
  </head>
  <body></body>
</html>
